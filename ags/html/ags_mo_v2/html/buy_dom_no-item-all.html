<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0">
    <title>(국내선)부가서비스 구매하기 - 모든 부가서비스를 구매할 수 없을 때</title>
    <link rel="stylesheet" href="../resource/css/swiper.min.css">
    <link rel="stylesheet" href="../resource/css/ags_mo.dom.min.css"><!-- 국내선일 경우 -->
    <script src="../resource/js/jquery-3.4.1.min.js"></script>
    <script src="../resource/js/swiper.min.js"></script>
    <script src="../resource/js/ags_mo.ui.js"></script>
    <script>
        var $win = $(window),
            $doc = $(document),
            $html = $("html"),
            $body = $("body");

        /*좌석 범례 스크롤 기능 정의*/
        function legendHandler(){
            var $psgWrap = $(".tab-panel.active .passenger-wrap"),
                $legendWrap = $(".tab-panel.active .seat-legend"),
                pd = 7,
                mgTop = $psgWrap.height() + $legendWrap.height(),
                items = [],
                pos = [];
            $($legendWrap.find("a")).each(function(index, item){
                var position = $($(".tab-panel.active .seat-num ." + $(item)[0].dataset.scrollto + ":first-of-type")).offset().top - mgTop - pd;

                pos.push(position);
                items.push($(item)[0].dataset.scrollto)
            });
            $win.on("scroll", function(e){
                setTimeout(function(){
                    var currentScroll = $html.scrollTop();
                    for (i in pos) {
                        if (pos[i] <= currentScroll + 5) {
                            var index = i,
                                $currentLegend = $(".tab-panel.active .seat-legend ." + items[index]);
                            $currentLegend.addClass("active").siblings().removeClass("active");
                        } else if(currentScroll + 5 <= pos[0]) {
                            $(".tab-panel.active .seat-legend ." + items[0]).addClass("active").siblings().removeClass("active");
                        }
                    }
                }, 800);
                activeLinkScrollLeft($(".tab-panel.active .seat-legend .active"), $legendWrap, 800);
            }).scroll()
        }

        $doc.ready(function(){
            /*팝업 불러오기*/
            $("#popup").load("include/popup.html");

            /* 좌석 선택 방식을 컨트롤 합니다. */
            (function(seatHandler){
                var $tabPanel = $(".ags-snb + .tab-panels .tab-panel");
                $tabPanel.each(function(){
                    var $thisPanel = $(this),
                        $psgLists = $thisPanel.find("[data-select='passenger']")/*승객 선택 체크박스 전체*/,
                        $selectSeats = $thisPanel.find("[data-select='seat']")/*좌석 선택 버튼 전체*/,
                        $target = $selectSeats.find("a[class*='seat-']:not([class*='disabled']")/*비활성화 되지 않은 좌석 선택 버튼 전체*/;

                    /*페이지 로드 시 첫번째 승객이 선택된 상태로 보이게 합니다*/
                    $psgLists.find("li:first-child input[type='radio']").prop("checked", true);

                    /*비활성화 되지 않은 좌석 선택 버튼을 클릭하면 다음 기능을 수행합니다*/
                    $target.on("click", function(){
                        var $this = $(this)/*클릭한 좌석 버튼*/,
                            $checkedPsg = $psgLists.find($("input[type='radio']:checked"))/*현재 선택된 승객*/,
                            $currentPsgLabel = $psgLists.find("input[type='radio']:checked ~ dl .selected-seat + dd")/*현재 선택된 승객의 좌석 텍스트*/,
                            $checkedPsgName = $checkedPsg.parent("li").find(".passenger-name").next("dd").text()/*현재 선택된 승객의 성명*/;
                        /*1. 승객의 좌석부여 상태별 IF 조건문*/
                        if($this.attr("data-psg") === undefined || $this.attr("data-psg") === "")
                            /*1-1. 해당 승객이 아무런 좌석을 부여받지 않은 상태일 때, 선택한 좌석을 부여합니다*/{
                            /*좌석버튼 가운데 해당 승객의 이름으로 마크된 좌석이 있을 경우, 좌석 부여를 취소합니다*/
                            $selectSeats.find("a[data-psg='" + $checkedPsgName + "']").attr("data-psg", "").removeClass("active");
                            /*선택한 좌석버튼을 활성화하고 data-psg 값에 현재 체크된 승객명을 구분자로 부여합니다*/
                            $this.addClass("active").attr("data-psg", $checkedPsgName);
                            /*현재 선택된 승객의 좌석 텍스트를 선택된 좌석 텍스트로 입력한 후 '삭제'버튼을 추가합니다*/
                            if($checkedPsg.siblings("dl").find("[class*='bundle-type']:not(.bundle-type0)").length !== 0){
                                /*번들 고객이라면*/
                                /*현재 선택된 승객의 좌석 텍스트를 선택된 좌석정보를 입력한 후 '삭제'버튼을 추가합니다*/
                                $currentPsgLabel.html("<span>" + $this.text().split("/")[0] + "</span><a href='#none' target='_self' class='btn_delete'>삭제</a>");
                            } else {
                                /*번들 고객이 아니라면*/
                                /*현재 선택된 승객의 좌석 텍스트를 선택된 좌석정보 + 가격정보를 입력한 후 '삭제'버튼을 추가합니다*/
                                $currentPsgLabel.html("<span>" + $this.text() + "</span><a href='#none' target='_self' class='btn_delete'>삭제</a>");
                            }
                        } else if($this.attr("data-psg") === $checkedPsgName)
                            /*1-2. 선택한 좌석이 해당 승객에게 이미 부여된 상태일 때, 좌석 부여를 취소합니다*/{
                            /*선택한 좌석과 동일한 좌석 텍스트를 삭제합니다*/
                            $(".tab-panel.active .selected-seat + dd").each(function(){
                                if($(this).find("span").text() ===  $this.text()){
                                    $(this).html("");
                                }
                            });
                            /*선택한 좌석을 비활성화하고, data-psg 값을 비워줍니다*/
                            $this.removeClass("active").attr("data-psg", "");
                        } else
                            /*1-3. 선택한 좌석이 다른 승객에게 부여된 좌석일 때, 현재 승객에게 좌석을 새로이 부여합니다*/{
                            /*선택한 좌석과 동일한 좌석 텍스트를 삭제합니다*/
                            $(".tab-panel.active .selected-seat + dd").each(function(){
                                if($(this).find("span").text() === $this.text()){
                                    $(this).html("");
                                }
                            });
                            /*좌석버튼 가운데 해당 승객의 이름으로 마크된 좌석이 있을 경우, 좌석 부여를 취소합니다*/
                            $selectSeats.find("a[data-psg='" + $checkedPsgName + "']").attr("data-psg", "").removeClass("active");
                            /*클릭한 좌석 버튼을 활성화하고 data-psg 값에 현재 체크된 승객명을 구분자로 부여합니다*/
                            $this.addClass("active").attr("data-psg", $checkedPsgName);
                            /*현재 선택된 승객의 좌석 텍스트를 선택된 좌석 텍스트로 입력한 후 '삭제'버튼을 추가합니다*/
                            $currentPsgLabel.html("<span>" + $this.text() + "</span><a href='#none' target='' class='btn_delete'>삭제</a>");
                        }

                        /*2. IF문을 처리한 이후 다음 승객으로 포커스 이동*/
                        if($checkedPsg.parent("li").next("li").length > 0) {
                            setTimeout(function(){
                                /*다음 승객이 존재하면 다음 승객으로 포커스를 넘깁니다*/
                                $checkedPsg.parent("li").next("li").find("input[type='radio']").prop("checked", true);
                                /*포커스를 가진 승객이 화면 좌측에 위치할 수 있도록 스크롤을 이동합니다*/
                                activeLinkScrollLeft($checkedPsg.parent("li").next("li"), $psgLists.parent(".passenger-wrap"), 800);
                            }, 1000);
                        } else if ($checkedPsg.parent("li").next("li").length === 0) {
                            /*다음 승객이 없고 다음 탭이 있을 경우, 하단 프로세스 버튼 영역으로 포커스를 내려줍니다*/
                            fixedElHeight = 0 + 32;
                            $("[data-ui='fixed']").each(function(){
                                fixedElHeight += $(this).outerHeight();
                            });
                            setTimeout(function() {
                                $("html").animate({
                                    scrollTop: $(".tab-panel.active [data-role='process-btn-wrap']").offset().top - fixedElHeight
                                }, 750);
                            }, 1000)
                        }
                    });

                    /*승객에게 좌석을 부여한 뒤, 좌석 텍스트 뒤에 붙는 삭제(X)버튼의 기능을 정의합니다*/
                    $thisPanel.on("click", ".btn_delete", function(){
                        var $this = $(this)/*클릭한 삭제버튼*/;
                        owner = $this.parents("dl").find(".passenger-name + dd").text()/*클릭한 삭제버튼이 작동할 승객의 성명*/;

                        /*승객의 성명으로 마킹된 좌석을 찾아 마킹을 지워줍니다*/
                        $(".tab-panel.active .seat-num a.active[data-psg='" + owner + "']").attr("data-psg", "").removeClass("active");

                        /*해당 승객에게 포커스를 맞춰줍니다*/
                        $this.closest("dl").siblings("input[type='radio']").prop("checked", true);
                        activeLinkScrollLeft($this.closest("li"), $psgLists.parent(".passenger-wrap"), 800);

                        /*승객의 좌석 텍스트를 삭제합니다*/
                        $this.parent("dd").html("")
                    });
                });
            })();

            /*[data-role='process-btn-wrap'] 버튼의 탭 전환 기능 정의*/
            (function(nextTab){

                /*가는 편 탭의 .btn_confirm 버튼을 누르면 오는 편 탭으로 이동합니다*/
                moveTabByClick("#tab-panel1-1 [data-role='process-btn-wrap'] .btn_confirm", "li[aria-controls='tab-panel1-2']", 0, 800);
                moveTabByClick("#tab-panel1-2 [data-role='process-btn-wrap'] .btn_cancel", "li[aria-controls='tab-panel1-1']", 0, 800);

                /*오는 편 탭의 .btn_cancel 버튼을 누르면 가는 편 탭으로 이동합니다*/
                moveTabByClick("#tab-panel2-1 [data-role='process-btn-wrap'] .btn_confirm", "li[aria-controls='tab-panel2-2']", 0, 800);
                moveTabByClick("#tab-panel2-2 [data-role='process-btn-wrap'] .btn_cancel", "li[aria-controls='tab-panel2-1']", 0, 800);
            })();

            /*좌석 범례 클릭 기능 정의*/
            (function(legendClickHandler) {
                $doc.on("click", ".tab-panel.active .seat-legend a", function() {
                    var $this = $(this)/*클릭된 범례 아이템*/,
                        $target = $(".tab-panel.active .seat-num a[class='" + $this.attr("data-scrollTo") + "']:first-of-type")/*클릭된 범례 아이템과 일치하는 좌석 중 가장 첫번째 아이템*/,
                        position = $target.offset().top - $(".tab-panel.active .passenger-wrap").height() - $(".tab-panel.active .seat-legend").height() - 7; /*클릭된 범례 아이템과 일치하는 좌석 중 첫번째의 화면 위치*/
                    /*활성화된 범례 아이템과 일치하는 좌석 중 첫번째가 위치한 곳으로 화면을 이동합니다*/
                    $("html").animate({scrollTop: position}, 800);
                });
            })();

            /*번들선택*/
            (function(){
                $(window).on("scroll", function(){
                    if ($(window).scrollTop() > 100){
                        $(".floating-banner").css("opacity", "0").removeClass("active")
                    } else {
                        $(".floating-banner").css("opacity", 1 - ($(window).scrollTop() * 0.01)).addClass("active")
                    }
                }).scroll();
            })();
        });

        $win.on("load", function(){
            /*가는 편/오는 편 스와이프 탭 기능 정의*/
            (function(){
                var swiper = new Swiper('#tabs_route', {
                    navigation: {
                        nextEl: '.swiper-button-next',
                        prevEl: '.swiper-button-prev',
                    },
                    pagination: {
                        el: '.swiper-pagination',
                        clickable: true,
                    },
                    slidesPerView: 1,
                    loop: false,
                });
                swiper.on('transitionStart', function() {
                    var $this = $($("#tabs_route").find(".swiper-slide")[swiper.activeIndex]);
                    $(".ags-snb").find("li[aria-controls='" + $this.attr("data-aria-target") + "']").mousedown();
                    if($this.attr("data-aria-target") === 'tab-panel1-1'){
                        $(".ags-snb li[aria-controls='tab-panel2-1'], .ags-snb li[aria-controls='tab-panel2-2']").hide();
                        $(".ags-snb li[aria-controls='tab-panel1-1'], .ags-snb li[aria-controls='tab-panel1-2']").show();
                        legendHandler()
                    } else if($this.attr("data-aria-target") === 'tab-panel2-1'){
                        $(".ags-snb li[aria-controls='tab-panel1-1'], .ags-snb li[aria-controls='tab-panel1-2']").hide();
                        $(".ags-snb li[aria-controls='tab-panel2-1'], .ags-snb li[aria-controls='tab-panel2-2']").show();
                        legendHandler()
                    }
                }).transitionStart();
                $("[data-swiper-next='#" + swiper.el.id + "']").on("click", function(){
                    $("html").animate({scrollTop: 0}, 1000);
                    setTimeout(function(){
                        swiper.slideNext();
                    }, 1200)
                });
                $("[data-swiper-prev='#" + swiper.el.id + "']").on("click", function(){
                    $("html").animate({scrollTop: 0}, 1000)
                    setTimeout(function(){
                        swiper.slidePrev();
                    }, 1200)
                });
            })();
        })
    </script>
</head>
<body>
	<div id="ags-wrap" class="ags-wrap">
        <h1 class="site-name">올윈에어</h1>

        <!-- ags-header -->
        <header id="ags-header" class="ags-header">
            <!-- 제주항공이고 && 기내면세 오픈했을 경우 -->
            <!--<h2 class="page-name"><a href="#nav-shortcut" target="_self" id="btn_nav-shortcut" class="btn_nav-shortcut">부가서비스 신청 <i class="ico_nav-dropdown"></i></a></h2>
            <div id="nav-shortcut" class="nav-shortcut">
                <ul>
                    <li class="active"><a href="#none" target="_self">부가서비스 사전구매</a></li>
                    <li><a href="dfs_list.html" target="_self">기내면세 예약</a></li>
                </ul>
            </div>-->

            <!-- 기내면세 오픈 전 제주항공 || 티웨이항공일 경우 -->
            <h2 class="page-name">부가서비스 신청</h2>

            <nav class="ags-gnb">
                <h3 class="sr-only">전역메뉴</h3>
                <ul class="gnb-wrap">
                    <li><a href="#none" target="_self" class="btn_back">뒤로가기</a></li>
                    <li>
                        <a href="#none" target="_self" id="btn_gnb" class="btn_gnb">메뉴</a>
                        <div id="gnb-2dp" class="gnb-2dp-wrap">
                            <a href="#none" target="_self" id="btn_gnb-close" class="btn_close">메뉴 닫기</a>
                            <p class="welcome-msg">
                                안녕하세요!<br>
                                <span class="customer-name">Bae, Sungjune</span>님
                            </p>
                            <ul class="depth1">
                                <li><a href="#none" target="_self">항공 부가서비스 사전 신청</a></li>
                                <li class="new active"><a href="#none" target="_self">기내 면세품 예약</a></li><!-- 활성화된 메뉴는 .active -->
                                <li>
                                    <a href="#none" target="_self">마이페이지</a>
                                    <ul class="depth2">
                                        <li><a href="#none" target="_self">부가서비스 신청내역</a></li>
                                        <li><a href="#none" target="_self">기내 면세품 예약내역</a></li>
                                    </ul>
                                </li>
                            </ul>
                            <ul class="fnb">
                                <li><a href="#none" target="_self">개인정보취급방침</a></li>
                            </ul>
                        </div>
                    </li>
                    <li><a href="#none" target="_self" class="btn_close">화면 닫기</a></li>
                </ul>
            </nav>
        </header>
        <!-- //ags-header -->

        <hr>

        <!-- ags-container -->
        <div class="ags-container">
            <section class="ags-contents" data-page-id="buy__dom">
                <h3 class="sr-only">컨텐츠</h3>


                <div class="tab-wrap">

                    <!-- 가는편/오는편 선택 -->
                    <div class="tabs tabs_route swiper-container">
                        <ul role="tablist" class="swiper-wrapper">
                            <li role="tab" aria-controls="tab-panel1" class="swiper-slide">
                                <i class="ico_tag">가는 편</i>
                                <div class="ticket-info">
                                    <h3 class="sr-only">티켓 정보</h3>
                                    <dl class="airport">
                                        <dt class="departure">출발지</dt>
                                        <dd><span class="iata-code">GMP</span> 서울(김포)</dd>
                                        <dt class="arrival">도착지</dt>
                                        <dd><span class="iata-code">PUS</span> 부산</dd>
                                        <dt class="airline">항공사</dt>
                                        <dd><i class="ico_7c">제주항공</i></dd>
                                        <dt class="schedule">여정일</dt>
                                        <dd>2020.11.16(월)</dd>
                                    </dl>
                                </div>
                            </li>
                            <li role="tab" aria-controls="tab-panel2" class="swiper-slide">
                                <i class="ico_tag">오는 편</i>
                                <div class="ticket-info">
                                    <h3 class="sr-only">티켓 정보</h3>
                                    <dl class="airport">
                                        <dt class="departure">출발지</dt>
                                        <dd><span class="iata-code">PUS</span> 부산</dd>
                                        <dt class="arrival">도착지</dt>
                                        <dd><span class="iata-code">GMP</span> 서울(김포)</dd>
                                        <dt class="airline">항공사</dt>
                                        <dd><i class="ico_tw">티웨이항공</i></dd>
                                        <dt class="schedule">여정일</dt>
                                        <dd>2020.11.26(월)</dd>
                                    </dl>
                                </div>
                            </li>
                        </ul>
                        <div class="swiper-button-next"><i class="ico"></i></div>
                        <div class="swiper-button-prev"><i class="ico"></i></div>
                        <div class="swiper-pagination"></div>
                    </div>



                    <div class="tab-panels">
                        <div class="align-horizontal">
                            <div id="tab-panel1" class="tab-panel" role="tabpanel">
                                <h3 class="sr-only">가는 편</h3>

                                <!-- **** 분기 : 제주항공 / 가는 편 또는 오는 편의 모든 부가서비스를 제공할 수 없을 때 **** -->
                                <div class="no-item">
                                    <div class="ico-wrap">
                                        <i class="ico_alert--primary">!</i>
                                    </div>
                                    <h3 class="alert-title">
                                        항공기 출발 시간이 임박하여<br>
                                        부가 서비스를 구매할 수 없습니다.
                                    </h3>
                                    <ul class="alert-text">
                                        <li>
                                            <strong class="alert-text-title">좌석</strong>
                                            출발 24시간전까지 구매 가능
                                        </li>
                                        <li>
                                            <strong class="alert-text-title">수하물</strong>
                                            출발 24시간전까지 구매 가능
                                        </li>
                                        <li>
                                            <strong class="alert-text-title">기내식</strong>
                                            출발 3일전까지 구매 가능<br>
                                            (예 : 5/5일 출발 → 5/2일까지 구매 가능)
                                        </li>
                                        <li>
                                            <strong class="alert-text-title">라운지</strong>
                                            출발 1일전 23:50까지 구매 가능<br>
                                            (예 : 5/5일 출발 → 5/4일 23:50 이 전까지 구매 가능)
                                        </li>
                                    </ul>
                                    <!-- 프로세스 버튼 그룹 -->
                                    <div class="process-btn-wrap" data-role="process-btn-wrap">
                                        <button type="button" class="btn_confirm">확인</button>
                                    </div>
                                </div>
                            </div>


                            <div id="tab-panel2" class="tab-panel" role="tabpanel">
                                <h3 class="sr-only">오는 편</h3>

                                <!-- **** 분기 : 티웨이항공 / 가는 편 또는 오는 편의 모든 부가서비스를 제공할 수 없을 때 **** -->
                                <div class="no-item">
                                    <div class="ico-wrap">
                                        <i class="ico_alert--primary">!</i>
                                    </div>
                                    <h3 class="alert-title">
                                        항공기 출발 시간이 임박하여<br>
                                        부가 서비스를 구매할 수 없습니다.
                                    </h3>
                                    <ul class="alert-text">
                                        <li>
                                            <strong class="alert-text-title">좌석</strong>
                                            사전 좌석은 항공기 출발 2일전까지만 구매 가능<br>
                                            (예 : 5월 5일 출발인 경우 5월 3일까지 구매 가능)
                                        </li>
                                        <li>
                                            <strong class="alert-text-title">수하물</strong>
                                            사전 수하물은 항공기 출발 2일전까지만 구매 가능<br>
                                            (예 : 5월 5일 출발인 경우 5월 3일까지 구매 가능)
                                        </li>
                                        <li>
                                            <strong class="alert-text-title">기내식</strong>
                                            사전 기내식은 항공기 출발 3일전까지만 구매 가능<br>
                                            (예 : 5월 5일 출발인 경우 5월 2일까지 구매 가능)
                                        </li>
                                    </ul>
                                    <!-- 프로세스 버튼 그룹 -->
                                    <div class="process-btn-wrap" data-role="process-btn-wrap">
                                        <button type="button" class="btn_confirm">확인</button>
                                    </div>
                                </div>
                            </div>
                            </div>
                        </div>


                </div>
            </section>
        </div>
        <!-- //ags-container -->

        <hr>

        <!-- ags-summary -->
        <footer id="ags-summary" class="ags-summary">
            <h4 class="sr-only">부가서비스 결제금액</h4>
            <a href="#none" target="_self" class="btn_drawer" data-popup="#passenger-summary_dom"><i class="ico"></i>총 결제 금액 슬라이드 열기/닫기</a>
            <div class="inner-wrap">
                <div class="total">
                    <h5 class="sr-only">총 결제 금액</h5>
                    <dl>
                        <dt><a href="#none" target="_self" data-popup="#passenger-summary_dom">총 결제 금액 자세히 보기</a></dt>
                        <dd><span class="digits">30000</span></dd>
                        <dd><button type="button" class="btn_pay-imm" onClick="location.href='pay_payment.html'">바로 결제하기</button></dd>
                    </dl>
                </div>
            </div>
        </footer>
        <!-- //ags-summary -->
    </div>

    <div id="popup"></div>
</body>
</html>